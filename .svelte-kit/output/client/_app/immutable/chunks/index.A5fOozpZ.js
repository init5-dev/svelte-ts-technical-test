import{U as Me,N as Ze,P as Be,a as qe,b as je,H as We,p as Je,i as Oe,c as fe,d as Ne,e as Ye}from"./entry.rfhwLhrg.js";import{p as se,n as Ge}from"./stores.abm3qHiY.js";import{d as ae,w as Z}from"./index.qaMdkIhf.js";import{I as _,J as ge,t as Ie}from"./scheduler.bX6PUre-.js";const Ke=!0;class me extends Error{constructor(t,n){super(t),this.name="DevalueError",this.path=n.join("")}}function _e(e){return Object(e)!==e}const Xe=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Qe(e){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null||Object.getOwnPropertyNames(t).sort().join("\0")===Xe}function ze(e){return Object.prototype.toString.call(e).slice(8,-1)}function et(e){switch(e){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e<" "?`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function ee(e){let t="",n=0;const s=e.length;for(let a=0;a<s;a+=1){const i=e[a],r=et(i);r&&(t+=e.slice(n,a)+r,n=a+1)}return`"${n===0?e:t+e.slice(n)}"`}function tt(e,t){const n=[],s=new Map,a=[];for(const f in t)a.push({key:f,fn:t[f]});const i=[];let r=0;function u(f){if(typeof f=="function")throw new me("Cannot stringify a function",i);if(s.has(f))return s.get(f);if(f===void 0)return Me;if(Number.isNaN(f))return Ze;if(f===1/0)return Be;if(f===-1/0)return qe;if(f===0&&1/f<0)return je;const g=r++;s.set(f,g);for(const{key:d,fn:b}of a){const p=b(f);if(p)return n[g]=`["${d}",${u(p)}]`,g}let m="";if(_e(f))m=ye(f);else switch(ze(f)){case"Number":case"String":case"Boolean":m=`["Object",${ye(f)}]`;break;case"BigInt":m=`["BigInt",${f}]`;break;case"Date":m=`["Date","${f.toISOString()}"]`;break;case"RegExp":const{source:b,flags:p}=f;m=p?`["RegExp",${ee(b)},"${p}"]`:`["RegExp",${ee(b)}]`;break;case"Array":m="[";for(let w=0;w<f.length;w+=1)w>0&&(m+=","),w in f?(i.push(`[${w}]`),m+=u(f[w]),i.pop()):m+=We;m+="]";break;case"Set":m='["Set"';for(const w of f)m+=`,${u(w)}`;m+="]";break;case"Map":m='["Map"';for(const[w,N]of f)i.push(`.get(${_e(w)?ye(w):"..."})`),m+=`,${u(w)},${u(N)}`;m+="]";break;default:if(!Qe(f))throw new me("Cannot stringify arbitrary non-POJOs",i);if(Object.getOwnPropertySymbols(f).length>0)throw new me("Cannot stringify POJOs with symbolic keys",i);if(Object.getPrototypeOf(f)===null){m='["null"';for(const w in f)i.push(`.${w}`),m+=`,${ee(w)},${u(f[w])}`,i.pop();m+="]"}else{m="{";let w=!1;for(const N in f)w&&(m+=","),w=!0,i.push(`.${N}`),m+=`${ee(N)}:${u(f[N])}`,i.pop();m+="}"}}return n[g]=m,g}const c=u(e);return c<0?`${c}`:`[${n.join(",")}]`}function ye(e){const t=typeof e;return t==="string"?ee(e):e instanceof String?ee(e.toString()):e===void 0?Me.toString():e===0&&1/e<0?je.toString():t==="bigint"?`["BigInt","${e}"]`:String(e)}const Ve=Ke;function ce(e){return e.toString().split(/[[\].]+/).filter(t=>t)}function Ce(e){return e.reduce((t,n)=>{const s=String(n);return typeof n=="number"||/^\d+$/.test(s)?t+=`[${s}]`:t?t+=`.${s}`:t+=s,t},"")}class D extends Error{constructor(t){super(t),Object.setPrototypeOf(this,D.prototype)}}function le(e,t,n){return e[t]=n,"skip"}function we(e,t){return t.value!==void 0&&typeof t.value!="object"&&t.path.length<e.length}function Ae(e,t,n={}){n.modifier||(n.modifier=a=>we(t,a)?void 0:a.value);const s=L(e,t,n.modifier);if(s)return n.value===void 0||n.value(s.value)?s:void 0}function L(e,t,n){if(!t.length||!e)return;const s=[t[0]];let a=e;for(;s.length<t.length;){const r=s[s.length-1],u=n?n({parent:a,key:String(r),value:a[r],path:s.map(c=>String(c)),isLeaf:!1,set:c=>le(a,r,c)}):a[r];if(u===void 0)return;a=u,s.push(t[s.length])}if(!a)return;const i=t[t.length-1];return{parent:a,key:String(i),value:a[i],path:t.map(r=>String(r)),isLeaf:!0,set:r=>le(a,i,r)}}function q(e,t,n=[]){for(const s in e){const a=e[s],i=a===null||typeof a!="object",r={parent:e,key:s,value:a,path:n.map(String).concat([s]),isLeaf:i,set:c=>le(e,s,c)},u=t(r);if(u==="abort")return u;if(u==="skip")continue;if(!i){const c=q(a,t,r.path);if(c==="abort")return c}}}async function rt(e,t,n=[]){for(const s in e){const a=e[s],i=a===null||typeof a!="object",r={parent:e,key:s,value:a,path:n.map(String).concat([s]),isLeaf:i,set:c=>le(e,s,c)},u=await t(r);if(u==="abort")return u;if(u==="skip")break;if(!i){const c=q(a,t,r.path);if(c==="abort")return c}}}function nt(e,t){return e===t||e.size===t.size&&[...e].every(n=>t.has(n))}function at(e,t){const n=new Map;function s(a,i){const r=L(i,a.path);function u(){n.set(a.path.join(" "),a.path)}a.isLeaf?r?a.value!==r.value&&u():u():r&&(a.value instanceof Date&&r.value instanceof Date&&a.value.getTime()!=r.value.getTime()||a.value instanceof Set&&r.value instanceof Set&&!nt(a.value,r.value))&&u()}return q(e,a=>s(a,t)),q(t,a=>s(a,e)),Array.from(n.values())}function G(e,t,n){for(const s of t){const a=L(e,s,({parent:i,key:r,value:u})=>((u===void 0||typeof u!="object")&&(i[r]={}),i[r]));a&&(a.parent[a.key]=n)}}function be(e,t){const n=ce(t),s=ae(e,a=>L(a,n)?.value);return{subscribe(...a){const i=s.subscribe(...a);return()=>i()},update(a){e.update(i=>{const r=L(i,n,({parent:u,key:c,value:f})=>(f===void 0&&(u[c]=/\D/.test(c)?{}:[]),u[c]));return r&&(r.parent[r.key]=a(r.value)),i})},set(a){e.update(i=>{const r=L(i,n,({parent:u,key:c,value:f})=>(f===void 0&&(u[c]=/\D/.test(c)?{}:[]),u[c]));return r&&(r.parent[r.key]=a),i})}}}function Te(e,t,n){typeof n.value=="object"&&(n.value=te(n.value)),!n.enumerable||n.get||n.set||!n.configurable||!n.writable||t==="__proto__"?Object.defineProperty(e,t,n):e[t]=n.value}function te(e){if(typeof e!="object")return e;var t=0,n,s,a,i=Object.prototype.toString.call(e);if(i==="[object Object]"?a=Object.create(e.__proto__||null):i==="[object Array]"?a=Array(e.length):i==="[object Set]"?(a=new Set,e.forEach(function(r){a.add(te(r))})):i==="[object Map]"?(a=new Map,e.forEach(function(r,u){a.set(te(u),te(r))})):i==="[object Date]"?a=new Date(+e):i==="[object RegExp]"?a=new RegExp(e.source,e.flags):i==="[object DataView]"?a=new e.constructor(te(e.buffer)):i==="[object ArrayBuffer]"?a=e.slice(0):i.slice(-6)==="Array]"&&(a=new e.constructor(e)),a){for(s=Object.getOwnPropertySymbols(e);t<s.length;t++)Te(a,s[t],Object.getOwnPropertyDescriptor(e,s[t]));for(t=0,s=Object.getOwnPropertyNames(e);t<s.length;t++)Object.hasOwnProperty.call(a,n=s[t])&&a[n]===e[n]||Te(a,n,Object.getOwnPropertyDescriptor(e,n))}return a||e}function K(e){return te(e)}function it(e){const t=e;let n=!0,s=!1,a=!1,i=!1,r,u;for(;n;)switch(e._def.typeName){case"ZodNullable":s=!0,e=e.unwrap();break;case"ZodDefault":i=!0,u=e._def.defaultValue(),e=e._def.innerType;break;case"ZodOptional":a=!0,e=e.unwrap();break;case"ZodEffects":r||(r=e),e=e._def.schema;break;case"ZodPipeline":e=e._def.out;break;case"ZodBranded":e=e.unwrap();break;default:n=!1}return{zodType:e,originalType:t,isNullable:s,isOptional:a,hasDefault:i,defaultValue:u,effects:r}}const pe=new WeakMap;function ve(e){return pe.has(e)||pe.set(e,ie(e)),pe.get(e)}function ie(e){const t=it(e).zodType;if(t._def.typeName=="ZodObject")return Object.fromEntries(Object.entries(t.shape).map(([n,s])=>[n,ie(s)]).filter(n=>n[1]!==void 0));if(t._def.typeName=="ZodArray")return ie(t._def.type)??{};if(t._def.typeName=="ZodRecord")return ie(t._def.valueType)??{};if(t._def.typeName=="ZodUnion")return t._def.options.reduce((s,a)=>{const i=ie(a);return i&&(s={...s??{},...i}),s},void 0)}function de(e,t,n=!0){const s={},a=Object.entries(e);if("_errors"in e&&e._errors.length){if(!t||!n)return e._errors;s._errors=e._errors}for(const[i,r]of a.filter(([u])=>u!=="_errors")){const u=/^\d+$/.test(i);s[i]=de(r,t?u?t:t[i]:void 0,!!t?.[i])}return s}function st(e){return Le(e,[])}function Le(e,t){return Object.entries(e).filter(([,s])=>s!==void 0).flatMap(([s,a])=>{if(Array.isArray(a)&&a.length>0){const i=t.concat([s]);return{path:Ce(i),messages:a}}else return Le(e[s],t.concat([s]))})}function Ee(e,t){e.update(n=>(q(n,s=>{if(!(s.path.length==1&&s.path[0]=="_errors"&&!t.clearFormLevelErrors)&&Array.isArray(s.value))return s.set(void 0)}),t.undefinePath&&G(n,[t.undefinePath],void 0),n))}async function Re(e,t,n,s,a){return ot(e,t,n,s,a)}async function ot(e,t,n,s,a){let i=!0,r={};if(e)if("safeParseAsync"in e){const u=e,c=await u.safeParseAsync(t);i=c.success,c.success?t=c.data:r=de(c.error.format(),ve(u))}else{t={...t};for(const[f,g]of Object.entries(e))typeof g=="function"&&!(f in t)&&(t[f]=void 0);const u=e,c=[];await rt(t,async({value:f,path:g})=>{const m=g.filter(b=>/\D/.test(String(b))),d=L(u,m);if(typeof d?.value=="function"){const b=d.value;let p;if(Array.isArray(f))for(const w in f)try{p=await b(f[w]),p&&(i=!1,c.push({path:g.concat([w]),errors:typeof p=="string"?[p]:p??void 0}))}catch(N){i=!1,console.error(`Error in form validators for field "${g}":`,N)}else try{p=await b(f),p&&(i=!1,c.push({path:g,errors:typeof p=="string"?[p]:p??void 0}))}catch(w){i=!1,console.error(`Error in form validators for field "${g}":`,w)}}});for(const{path:f,errors:g}of c){const m=L(r,f,({parent:d,key:b,value:p})=>(p===void 0&&(d[b]={}),d[b]));if(m){const{parent:d,key:b}=m;d[b]=g}}}return{valid:i,posted:a,errors:r,data:t,constraints:s,message:void 0,id:n}}async function ut(e,t,n,s){if(typeof e.validators!="object"||!("safeParseAsync"in e.validators))return;const a=e.validators,i=await a.safeParseAsync(_(t));if(i.success)n.update(r=>(q(r,u=>{if(u.key=="_errors")return u.set(void 0)}),r));else{const r=de(i.error.format(),ve(a));n.update(u=>(q(u,c=>{if(c.key=="_errors")return c.set(void 0)}),q(r,c=>{if(c.key=="_errors"){const f=c.path.length==1?{value:!0}:s&&L(s,c.path.slice(0,-1));if(f&&f.value)return G(u,[c.path],c.value)}}),u))}}async function he(e,t,n,s,a,i={}){function r(){Ee(s,{undefinePath:e,clearFormLevelErrors:!0})}function u(f){return typeof f=="string"&&(f=[f]),(i.update===!0||i.update=="errors")&&s.update(g=>{const m=L(g,e,d=>{if(we(e,d))throw new D("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+d.path.slice(0,-1));return d.value===void 0?(d.parent[d.key]={},d.parent[d.key]):d.value});if(!m)throw new D("Error path could not be created: "+e);return m.parent[m.key]=f??void 0,g}),f??void 0}const c=await ft(e,t.validators,n,s,a,i);return c.validated?c.validated==="all"&&!c.errors?r():c.errors=u(c.errors):c.validated===!1&&t.defaultValidator=="clear"&&(c.errors=u(c.errors)),c}async function ft(e,t,n,s,a,i={}){i.update===void 0&&(i.update=!0),i.taint===void 0&&(i.taint=!1),typeof i.errors=="string"&&(i.errors=[i.errors]);const r={value:i.value,shouldUpdate:!0,currentData:void 0,validationPath:e.filter(d=>/\D/.test(String(d)))};async function u(){return{validated:!1,errors:void 0,data:void 0}}function c(d,b){if(b===void 0)return!1;const p=L(b,d);return p?p.value:!1}function f(d){s.update(d)}function g(){Ee(s,{undefinePath:null,clearFormLevelErrors:!0})}function m(d,b){return de(d.format(),ve(b))}if("value"in i)i.update===!0||i.update==="value"?n.update(d=>(G(d,[e],r.value),r.currentData=d),{taint:i.taint}):r.shouldUpdate=!1;else{r.currentData=_(n);const d=L(r.currentData,e);r.value=d?.value}if(typeof t!="object")return u();if("safeParseAsync"in t){r.shouldUpdate||(r.currentData=K(r.currentData??_(n)),G(r.currentData,[e],r.value));const d=await t.safeParseAsync(r.currentData);if(d.success)return g(),{validated:!0,errors:void 0,data:d.data};{const b=m(d.error,t);if(i.update===!0||i.update=="errors"){const w=_(a);f(N=>(q(N,k=>{if(k.key=="_errors")return k.set(void 0)}),q(b,k=>{if(k.key=="_errors"&&(k.path.length==1||c(k.path.slice(0,-1),w)))return G(N,[k.path],k.value);if(Array.isArray(k.value))return c(k.path,w)&&G(N,[k.path],k.value),"skip"}),N))}const p=L(b,e);return{validated:!0,errors:i.errors??p?.value,data:void 0}}}else{const d=L(t,r.validationPath);if(!d||d.value===void 0)return u();{const b=await d.value(r.value);return{validated:!0,errors:b&&(i.errors??b),data:void 0}}}}function ct(e){const t=JSON.parse(e);return t.data&&(t.data=Je(t.data)),t}function Fe(e){return HTMLElement.prototype.cloneNode.call(e)}function lt(e,t=()=>{}){const n=async({action:a,result:i,reset:r=!0,invalidateAll:u=!0})=>{i.type==="success"&&(r&&HTMLFormElement.prototype.reset.call(e),u&&await Oe()),(location.origin+location.pathname===a.origin+a.pathname||i.type==="redirect"||i.type==="error")&&fe(i)};async function s(a){if((a.submitter?.hasAttribute("formmethod")?a.submitter.formMethod:Fe(e).method)!=="post")return;a.preventDefault();const r=new URL(a.submitter?.hasAttribute("formaction")?a.submitter.formAction:Fe(e).action),u=new FormData(e),c=a.submitter?.getAttribute("name");c&&u.append(c,a.submitter?.getAttribute("value")??"");const f=new AbortController;let g=!1;const d=await t({action:r,cancel:()=>g=!0,controller:f,formData:u,formElement:e,submitter:a.submitter})??n;if(g)return;let b;try{const p=await fetch(r,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:u,signal:f.signal});b=ct(await p.text()),b.type==="error"&&(b.status=p.status)}catch(p){if(p?.name==="AbortError")return;b={type:"error",error:p}}d({action:r,formData:u,formElement:e,update:p=>n({action:r,result:b,reset:p?.reset,invalidateAll:p?.invalidateAll}),result:b})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",s)}}}const dt=(e,t=0)=>{const n=e.getBoundingClientRect();return n.top>=t&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)},mt=(e,t=1.125,n="smooth")=>{const i=e.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*t);window.scrollTo({left:0,top:i,behavior:n})};var C;(function(e){e[e.Idle=0]="Idle",e[e.Submitting=1]="Submitting",e[e.Delayed=2]="Delayed",e[e.Timeout=3]="Timeout"})(C||(C={}));const yt=new Set;let Pe=!1;function bt(e,t,n){let s=C.Idle,a,i,r=!1;const u=yt;function c(){f(),m(s!=C.Delayed?C.Submitting:C.Delayed),a=window.setTimeout(()=>{a&&s==C.Submitting&&m(C.Delayed)},n.delayMs),i=window.setTimeout(()=>{i&&s==C.Delayed&&m(C.Timeout)},n.timeoutMs),u.add(f)}function f(){clearTimeout(a),clearTimeout(i),a=i=0,u.delete(f),m(C.Idle)}function g(){u.forEach(E=>E()),u.clear()}function m(E){s=E,t.submitting.set(s>=C.Submitting),t.delayed.set(s>=C.Delayed),t.timeout.set(s>=C.Timeout)}const d=e;function b(E){const j=E.target;n.selectErrorText&&j.select()}function p(){n.selectErrorText&&d.querySelectorAll("input").forEach(E=>{E.addEventListener("invalid",b)})}function w(){n.selectErrorText&&d.querySelectorAll("input").forEach(E=>E.removeEventListener("invalid",b))}const N=e;function k(E){return typeof n.autoFocusOnError=="boolean"?n.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(E)}const X=async()=>{if(n.scrollToError=="off")return;const E=n.errorSelector;if(!E)return;await Ie();let j;if(j=N.querySelector(E),!j)return;j=j.querySelector(E)??j;const W=n.stickyNavbar?document.querySelector(n.stickyNavbar):null;if(typeof n.scrollToError!="string"?j.scrollIntoView(n.scrollToError):dt(j,W?.offsetHeight??0)||mt(j,void 0,n.scrollToError),!k(navigator.userAgent))return;let R;if(R=j,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(R.tagName)||(R=R.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),R)try{R.focus({preventScroll:!0}),n.selectErrorText&&R.tagName=="INPUT"&&R.select()}catch{}};{p();const E=(j,W=!1)=>{f(),j||setTimeout(X),W&&!r&&g()};return ge(()=>{w(),E(!0)}),Pe||(Ne(()=>{r=!0}),Ye(j=>{j.type!="enter"&&(r=!1,g())}),Pe=!0),{submitting:()=>{r=!1,c()},completed:E,scrollToFirstError:()=>{setTimeout(X)},isSubmitting:()=>s===C.Submitting||s===C.Delayed}}}function ke(e){!e.flashMessage||!Ve||Se(e)&&(document.cookie=`flash=; Max-Age=0; Path=${e.flashMessage.cookiePath??"/"};`)}function Se(e){return!e.flashMessage||!Ve?!1:e.syncFlashMessage}const $e="noCustomValidity";function Ue(e,t){const n=t&&t.length?t.join(`
`):"";e.setCustomValidity(n),n&&e.reportValidity()}function pt(e,t){for(const n of e.querySelectorAll("input,select,textarea,button")){if($e in n.dataset)continue;const s=L(t,ce(n.name));if(Ue(n,s?.value),s?.value)return}}function ht(e,t,n,s,a,i,r,u,c,f,g,m,d,b,p,w,N){f();const k=a;async function X(h,I,T){r.customValidity&&r.validationMethod!="submit-only"&&("setCustomValidity"in h&&h.setCustomValidity(""),!(I=="input"&&r.validationMethod=="onblur")&&($e in h.dataset||Ue(h,T)))}async function E(h,I,T){if(r.validationMethod=="submit-only")return;const F=await he(h,r,u,k,b);if(F.data&&T&&u.set(F.data),r.customValidity){const $=CSS.escape(Ce(h)),x=e.querySelector(`[name="${$}"]`);x&&X(x,I,F.errors)}}const j=["checkbox","radio","range"];function W(h){return h&&(h instanceof HTMLSelectElement||h instanceof HTMLInputElement&&j.includes(h.type))}async function R(h){if(r.validationMethod=="oninput"||r.validationMethod=="submit-only")return;const I=W(h.target);I&&await new Promise($=>setTimeout($,0));const T=_(p);if(!T.length)return;const F=h.target instanceof HTMLElement?h.target:null;for(const $ of T)E($,"blur",I?null:F);p.set([])}async function re(h){if(r.validationMethod=="onblur"||r.validationMethod=="submit-only")return;const I=W(h.target);I&&await new Promise($=>setTimeout($,0));const T=_(p);if(!T.length)return;const F=h.target instanceof HTMLElement?h.target:null;for(const $ of T){const x=I||L(_(k),$);(I||typeof x=="object"&&x.key in x.parent)&&setTimeout(()=>E($,"input",I?F:null),0)}}e.addEventListener("focusout",R),e.addEventListener("input",re),ge(()=>{e.removeEventListener("focusout",R),e.removeEventListener("input",re)});const H=bt(e,{submitting:t,delayed:n,timeout:s},r);let B;return lt(e,async h=>{const I=h.cancel;let T=!1;function F(U=!0){return T=!0,U&&H.isSubmitting()&&H.completed(!0),I()}if(h.cancel=F,H.isSubmitting()&&r.multipleSubmits=="prevent")F(!1);else{H.isSubmitting()&&r.multipleSubmits=="abort"&&B&&B.abort(),H.submitting(),B=h.controller;for(const U of g.onSubmit)await U(h)}if(T)r.flashMessage&&ke(r);else{const U=!r.SPA&&(e.noValidate||(h.submitter instanceof HTMLButtonElement||h.submitter instanceof HTMLInputElement)&&h.submitter.formNoValidate),S=await Re(U?void 0:r.validators,_(u),_(m),_(d),_(N));if(!S.valid){F(!1);const P={type:"failure",status:(typeof r.SPA=="boolean"?void 0:r.SPA?.failStatus)??400,data:{form:S}};setTimeout(()=>x({result:P}),0)}if(!T){switch(r.clearOnSubmit){case"errors-and-message":k.clear(),c.set(void 0);break;case"errors":k.clear();break;case"message":c.set(void 0);break}r.flashMessage&&(r.clearOnSubmit=="errors-and-message"||r.clearOnSubmit=="message")&&Se(r)&&r.flashMessage.module.getFlash(se).set(void 0);const P="formData"in h?h.formData:h.data;if(r.SPA){F(!1);const V={...S,posted:!0},M={type:V.valid?"success":"failure",status:V.valid?200:typeof r.SPA=="object"?r.SPA?.failStatus:400,data:{form:V}};setTimeout(()=>x({result:M}),0)}else if(r.dataType==="json"){const V=S.data,M=$(tt(V),r.jsonChunkSize??5e5);for(const O of M)P.append("__superform_json",O);Object.keys(V).forEach(O=>{typeof P.get(O)=="string"&&P.delete(O)})}if(!r.SPA&&!P.has("__superform_id")){const V=_(m);V!==void 0&&P.set("__superform_id",V)}}}function $(U,S){const P=Math.ceil(U.length/S),V=new Array(P);for(let M=0,O=0;M<P;++M,O+=S)V[M]=U.substring(O,O+S);return V}async function x(U){const S=U.result.type?U.result:{type:"error",status:500,error:U.result};B=null;let P=!1;const V={result:S,formEl:e,cancel:()=>P=!0};for(const M of g.onResult)await M(V);if(!P){if((S.type==="success"||S.type=="failure")&&S.data){const M=w(S.data);if(!M.length)throw new D("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const O of M){if(O.id!==_(m))continue;const oe={form:O,formEl:e,cancel:()=>P=!0};for(const Q of g.onUpdate)await Q(oe);!P&&r.customValidity&&pt(e,oe.form.errors)}}if(!P){if(S.type!=="error")S.type==="success"&&r.invalidateAll&&await Oe(),r.applyAction?await fe(S):await i(S);else{if(r.applyAction)if(r.onError=="apply")await fe(S);else{const M={type:"failure",status:Math.floor(S.status||500),data:S};await fe(M)}if(r.onError!=="apply"){const M={result:S,message:c};for(const O of g.onError)O!=="apply"&&(O!=De||!r.flashMessage?.onError)&&await O(M)}}r.flashMessage&&S.type=="error"&&r.flashMessage.onError&&await r.flashMessage.onError({result:S,message:r.flashMessage.module.getFlash(se)})}}if(P&&r.flashMessage&&ke(r),P||S.type!="redirect")H.completed(P);else if(S.type=="redirect")if(new URL(S.location,/^https?:\/\//.test(S.location)?void 0:document.location.origin).pathname==document.location.pathname)setTimeout(()=>{H.completed(!0,!0)},0);else{const M=Ge.subscribe(O=>{O||(M(),H.completed(P))})}}return x})}new TextEncoder;const De=e=>{console.warn("Unhandled Superform error, use onError event to handle it:",e.result.error)},gt={applyAction:!0,invalidateAll:!0,resetForm:!1,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:"Do you want to leave this page? Changes you made may not be saved.",onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:De,dataType:"form",validators:void 0,defaultValidator:"keep",customValidity:!1,clearOnSubmit:"errors-and-message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",validation:void 0,SPA:void 0,validateMethod:"auto"},ue=new WeakMap,z=new WeakMap;function wt(e){return`Duplicate form id's found: "${e}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}function At(e,t={}){t={...gt,...t},t.SPA&&t.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add them to the validators option, or set it to false to disable this warning.");let n=t.id;!e||b(e)===!1?(t.warnings?.noValidationAndConstraints!==!1&&console.warn((e?"Form data sent directly to superForm instead of through superValidate. No initial data validation is made. ":"No form data sent to superForm, schema type safety cannot be guaranteed. ")+"Also, no constraints will exist for the form. Set the warnings.noValidationAndConstraints option to false to disable this warning."),e={valid:!1,posted:!1,errors:{},data:e??{},constraints:{}}):n===void 0&&(n=e.id);const s=n,a=_(se);if(t.warnings?.duplicateId!==!1)if(!ue.has(a))ue.set(a,new Set([s]));else{const o=ue.get(a);o?.has(s)?console.warn(wt(s)):o?.add(s)}z.has(e)||z.set(e,K(e));const i=z.get(e);if(typeof i.valid!="boolean")throw new D("A non-validation object was passed to superForm. It should be an object of type SuperValidated, usually returned from superValidate.");a.form,e=K(i);const r=e,u=Z(r.errors),c=Z(n),f={taintedMessage:t.taintedMessage,taintedFormState:K(i.data)};function g(o=8){return Math.random().toString(36).substring(2,o+2)}function m(o){f.taintedFormState=K(o)}function d(o){return Object.values(o).filter(y=>b(y)!==!1)}function b(o){return!o||typeof o!="object"||!("valid"in o&&"errors"in o&&typeof o.valid=="boolean")?!1:"id"in o&&typeof o.id=="string"?o.id:void 0}function p(){t.taintedMessage=f.taintedMessage,n===void 0&&c.set(g())}function w(o){const l=Z(o);return{subscribe:l.subscribe,set:(y,v={})=>(S(y,f.taintedFormState,v.taint??!0),m(y),l.set(K(y))),update:(y,v={})=>l.update(A=>{const Y=y(A);return S(Y,f.taintedFormState,v.taint??!0),m(Y),Y})}}const N=[c.subscribe(o=>n=o)];function k(o){N.push(o)}function X(){N.forEach(o=>o())}const E=w(r.data);function j(o,l){if(!(!l||typeof l!="object")){if(Array.isArray(l))l.length>0&&j(o,l[0]);else if(!(l instanceof Date))throw new D(`Object found in form field "${o}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}}async function W(o,l){o.valid&&l&&t.resetForm&&(t.resetForm===!0||t.resetForm())?R(o.message):Q(o,l),J.onUpdated.length&&await Ie();for(const y of J.onUpdated)y({form:o})}function R(o,l,y){const v=K(i);v.data={...v.data,...l},y!==void 0&&(v.id=y),Q(v,!0,o)}const re=async(o,l)=>{if(o.type=="error")throw new D(`ActionResult of type "${o.type}" cannot be passed to update function.`);if(o.type=="redirect"){t.resetForm&&(t.resetForm===!0||t.resetForm())&&R();return}if(typeof o.data!="object")throw new D("Non-object validation data returned from ActionResult.");const y=d(o.data);if(!y.length)throw new D("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const v of y)v.id===n&&await W(v,l??(o.status>=200&&o.status<300))},H=Z([]),B=Z(r.message),h=Z(r.constraints),I=Z(!1),T={subscribe:u.subscribe,set:u.set,update:u.update,clear:()=>Ee(u,{undefinePath:null,clearFormLevelErrors:!0})},F=Z();function $(){return _(F)}function x(o){if(o===null)throw new D("$tainted store contained null");if(typeof o=="object"){for(const l of Object.values(o))if(x(l))return!0}return o===!0}async function U(o,l){let y=t.validationMethod==="oninput";if(!y){const v=_(T),A=v?Ae(v,o,{modifier:ne=>{if(we(o,ne))throw new D("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+ne.path.slice(0,-1));return ne.value}}):void 0;y=!!(A&&A.key in A.parent)}return y?(await he(o,t,E,T,F,{taint:l}),!0):!1}async function S(o,l,y){if(y=="ignore")return;let v=at(o,l);if(typeof y=="object"&&(typeof y.fields=="string"&&(y.fields=[y.fields]),v=y.fields.map(A=>ce(A)),y=!0),H.set(v),v.length&&(y==="untaint-all"?F.set(void 0):F.update(A=>{if(y!==!0&&A){const Y=A;v=v.filter(ne=>Ae(Y,ne)),v.length&&(A||(A={}),G(A,v,void 0))}else y===!0&&(A||(A={}),G(A,v,!0));return A}),!(t.validationMethod=="onblur"||t.validationMethod=="submit-only"))){let A=!1;for(const Y of v)A=A||await U(Y,y);A||await ut(t,E,T,_(F))}}function P(o,l){F.set(o),m(l)}const V=Z(!1),M=Z(!1),O=Z(!1),oe=ae(T,o=>o?st(o):[]);if(t.taintedMessage=void 0,ge(()=>{X();for(const o of Object.values(J))o.length=0;ue.get(a)?.delete(s)}),t.dataType!=="json")for(const[o,l]of Object.entries(r.data))j(o,l);function Q(o,l,y){if(l&&P(typeof l=="boolean"?void 0:l,o.data),y=y??o.message,E.set(o.data,{taint:"ignore"}),B.set(y),T.set(o.errors),c.set(o.id),I.set(o.posted),t.flashMessage&&Se(t)){const v=t.flashMessage.module.getFlash(se);y&&_(v)===void 0&&v.set(y)}}const J={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};Ne(o=>{if(t.taintedMessage&&!_(V)){const l=$();l&&x(l)&&!window.confirm(t.taintedMessage)&&o.cancel()}}),k(se.subscribe(async o=>{if(!t.applyAction)return;t.SPA&&await new Promise(y=>setTimeout(y,0));const l=o.status>=200&&o.status<300;if(o.form&&typeof o.form=="object"){const y=o.form;if(y.type=="error")return;const v=d(y);for(const A of v)A.id!==n||z.has(A)||(z.set(A,A),await W(A,l))}else if(o.data&&typeof o.data=="object"){const y=d(o.data);for(const v of y)v.id!==n||z.has(v)||Q(v,l)}}));const xe=Object.fromEntries(Object.keys(i.data).map(o=>[o,{name:o,value:be(E,o),errors:be(T,o),constraints:be(h,o)}]));async function He(o,l){return o===void 0?Re(t.validators,_(E),n,_(h),!1):(await he(ce(o),t,E,T,F,l)).errors}return{form:E,formId:c,errors:T,message:B,constraints:h,fields:xe,tainted:F,submitting:ae(V,o=>o),delayed:ae(M,o=>o),timeout:ae(O,o=>o),options:t,capture:function(){return{valid:i.valid,posted:_(I),errors:_(T),data:_(E),constraints:_(h),message:_(B),id:n,tainted:_(F)}},restore:function(o){return Q(o,o.tainted??!0)},validate:He,enhance:(o,l)=>{if(l){if(l.onError){if(t.onError==="apply")throw new D('options.onError is set to "apply", cannot add any onError events.');if(l.onError==="apply")throw new D('Cannot add "apply" as onError event in use:enhance.');J.onError.push(l.onError)}l.onResult&&J.onResult.push(l.onResult),l.onSubmit&&J.onSubmit.push(l.onSubmit),l.onUpdate&&J.onUpdate.push(l.onUpdate),l.onUpdated&&J.onUpdated.push(l.onUpdated)}return ht(o,V,M,O,T,re,t,E,B,p,J,c,h,F,H,d,I)},allErrors:oe,posted:I,reset:o=>R(o?.keepMessage?_(B):void 0,o?.data,o?.id)}}export{At as s};
